<!DOCTYPE html>
<html>
  <head>
    <title>Kwizzad Web SDK Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="index.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet">

    <script>
      // This function is called back by Kwizzad as soon as it is loaded completely.
      window.onKwizzadLoaded = function(Kwizzad) {
        var lastShowAdFunction = null;
        // Request an ad when the page is loaded
        var kwizzad = new Kwizzad({
          apiKey: 'b81e71a86cf1314d249791138d642e6c4bd08240f21dd31811dc873df5d7469d',
          placementId: 'tvsa'
        }).render().requestAd({
          // By supplying user data, your users can get better targeted ads. Each attribute is optional.
          user: {
            id: '12345',             // unique ID that identifies the user inside your app
            gender: 'female',        // 'male', 'female' or null
            name: 'Stefanie Müller', // user realname inside your app, if existing
            facebookUserId: '777'    // if your users log in over Facebook
          },

          // Kwizzad SDK calls this back when there is an ad for your request.
          onAdAvailable: function(showAd, potentialRewards) {
            // potentialRewards is an array of reward objects that the user can earn.
            var button = document.getElementById('kwizzad-button');
            button.innerHTML = potentialRewards.incentiveText;
            if (lastShowAdFunction) {
              button.removeEventListener('click', lastShowAdFunction);
            }
            lastShowAdFunction = showAd;
            button.addEventListener('click', lastShowAdFunction);
          },

          // Called back when the user played the campaign or dismissed the ad.
          onAdDismissed: function(pendingTransactions) {
            // You should show a UI that displays all pending transactions for the user.
            // Each transaction contains one or more rewards. The server will send the same
            // transactions again until your code confirms them by calling their `confirm` method,
            // like an inbox.
            pendingTransactions.forEach(function (transaction) {
              // Feel free to design a dialog that fits your UX and that feels rewarding!
              // Also available here:
              // - transaction.reward.amount
              // - transaction.reward.maxAmount
              // - transaction.reward.currency
              // - transaction.reward.valueDescription
              // - transaction.reward.debugValueDescription
              if (confirm(transaction.rewardConfirmationText())) {
                // Removes the transaction from the inbox and triggers payout
                transaction.confirm();
              }
            });
          },

          // Called back if no ad is available for your request
          onNoFill: function() {
            console.log('Kwizzad: No ad available.');
          },

          // Called back if the request could not be sent or the server responded with an error.
          onError: function(error) {
            console.log('Kwizzad: Ad request error:', error);
          }
        });
      };
    </script>
  </head>

  <body>
    <header>
      <h1>Kwizzad Web SDK Demo</h1>
      <img id='kwizzad-logo' src='icons/icon-512.png'>
    </header>

    <button id='kwizzad-button'>
      Requesting ad…
    </button>

    <script src="public/kwizzad.js" async defer></script>
  </body>
</html>
